{"version":3,"file":"CodeGroup.d6e97785.js","sources":["../../../../packages/theme-wulinks/src/shared/listenerGroup.ts","../../../../packages/theme-wulinks/src/client/components/CodeGroup.vue"],"sourcesContent":["import type { VNode } from 'vue';\r\nimport { randomAlphanumeric } from './randomStringUtils';\r\n\r\nexport interface Listener<T> {\r\n  key: string;\r\n  callback: (value: T) => void;\r\n}\r\n\r\n/**\r\n * 观察者组简易封装\r\n */\r\nexport class ListenerGroup<T> {\r\n  listeners: Array<Listener<T>> = [];\r\n\r\n  add(listener: Listener<T>) {\r\n    this.listeners.push(listener);\r\n  }\r\n\r\n  /**\r\n   * 触发整一组观察者的回调\r\n   * @param value 新的值\r\n   * @param fromMemberKey 如果是由其中一个观察者发起的，并且需要将它过滤掉，则传入它的key\r\n   */\r\n  notify(value: T, fromMemberKey?: string) {\r\n    this.listeners.filter((listener) => !fromMemberKey || listener.key !== fromMemberKey).forEach((listener) => listener.callback(value));\r\n  }\r\n}\r\n\r\n/**\r\n * 用于封装在渲染函数中对同一个值的变化进行响应的一组组件\r\n * 小声BB：这么重要的功能，vue居然没有直接提供，差评！\r\n */\r\nexport class RenderVModelGroup<T> {\r\n  group: ListenerGroup<T> = new ListenerGroup<T>();\r\n\r\n  static bind<T>(nodes: Array<VNode>) {\r\n    return new RenderVModelGroup<T>().add(nodes);\r\n  }\r\n\r\n  add(nodes: Array<VNode>) {\r\n    nodes.forEach((node) => {\r\n      this.group.add({\r\n        key: randomAlphanumeric(8, true),\r\n        callback: (value) => {\r\n          if (node.component && node.component.props) {\r\n            node.component.props.modelValue = value;\r\n          }\r\n        }\r\n      });\r\n      if (!node.props) {\r\n        node.props = {};\r\n      }\r\n      // 任一成员组件的modelValue需要发生变化时，令整一组所有组件的modelValue响应式地变更，这里不用排除该组件自身\r\n      node.props['onUpdate:modelValue'] = (value: T) => this.group.notify(value);\r\n    });\r\n  }\r\n}\r\n","<script lang=\"ts\">\nimport { defineComponent, h } from 'vue';\nimport type { Component, VNode } from 'vue';\nimport { QCard, QTabs, QTab, QTabPanels, QTabPanel } from 'quasar';\nimport { randomAlphanumeric } from '../../shared/randomStringUtils';\nimport { RenderVModelGroup } from '../../shared/listenerGroup';\n\nconst VALID_CODE_GROUP_ITEM_COMPONENT_NAMES = ['AsyncComponentWrapper', 'CodeGroupItem'];\n\ninterface VNodeWrapper {\n  vnode: VNode;\n  key: string;\n}\n\nexport default defineComponent({\n  name: 'CodeGroup',\n  setup(_, { slots }) {\n    return () => {\n      const items: Array<VNodeWrapper> = (slots.default?.() || [])\n        .filter((vnode) => {\n          const name = (vnode.type as Component).name;\n          if (!name) {\n            return false;\n          }\n          return VALID_CODE_GROUP_ITEM_COMPONENT_NAMES.indexOf(name) >= 0;\n        })\n        .filter((vnode) => !!vnode)\n        .map((vnode) => {\n          return {\n            vnode: vnode,\n            key: randomAlphanumeric(8, true)\n          };\n        });\n      const initialSelected = items.length ? `${items[0].key || ''}` : '';\n      const tabNav = h(\n        QTabs,\n        { modelValue: initialSelected, class: 'bg-primary text-weight-bolder text-white', align: 'justify', dense: true, narrowIndicator: true },\n        { default: () => items.map((item) => h(QTab, { name: item.key, label: `${item.vnode.props?.title}` || 'Untitled' })) }\n      );\n      const tabPanels = h(\n        QTabPanels,\n        { modelValue: initialSelected, class: 'code-group-panels', animated: true },\n        {\n          default: () =>\n            items.map((item) =>\n              h(\n                QTabPanel,\n                { name: item.key, class: 'code-group-panel' },\n                {\n                  default: () => {\n                    /*\n                     * Fucking Magic\n                     * 这个地方如果直接返回item.vnode，build之后会出问题，原因不明\n                     * Quasar、Vuepress、Vue有问题的嫌疑都不能排除，当然也可能是我们自己组件的写法不对，谁知道呢\n                     * 反正暂时就只能先这样写了，至于为什么这样写就可以，你问我我问谁啊\n                     */\n                    const codeSlot: any = item.vnode.children;\n                    if (!codeSlot || !codeSlot.default) {\n                      return [];\n                    }\n                    return codeSlot.default() || [];\n                  }\n                }\n              )\n            )\n        }\n      );\n      // 绑定同组v-model\n      RenderVModelGroup.bind<string>([tabNav, tabPanels]);\n      return h(QCard, {}, { default: () => [tabNav, tabPanels] });\n    };\n  }\n});\n</script>\n<style lang=\"scss\" scoped>\n.code-group-panels {\n  background-color: var(--code-bg-color);\n}\n\n.code-group-panel {\n  padding: 0;\n}\n</style>\n"],"names":["constructor","add","listener","listeners","push","notify","value","fromMemberKey","filter","key","forEach","callback","ListenerGroup","nodes","RenderVModelGroup","node","group","randomAlphanumeric","component","props","modelValue","this","VALID_CODE_GROUP_ITEM_COMPONENT_NAMES","defineComponent","name","setup","_","slots","items","default","vnode","type","indexOf","map","initialSelected","length","tabNav","h","QTabs","class","align","dense","narrowIndicator","item","QTab","label","title","tabPanels","QTabPanels","animated","QTabPanel","codeSlot","children","bind","QCard"],"mappings":"sKAWOA,6BAC2B,GAEhCC,IAAIC,QACGC,UAAUC,KAAKF,GAQtBG,OAAOC,EAAUC,QACVJ,UAAUK,QAAQN,IAAcK,GAAiBL,EAASO,MAAQF,IAAeG,SAASR,GAAaA,EAASS,SAASL,cAQ3HN,yBACqB,IAAIY,cAEfC,UACN,IAAIC,GAAuBb,IAAIY,GAGxCZ,IAAIY,KACIH,SAASK,SACRC,MAAMf,IAAI,CACbQ,IAAKQ,EAAmB,GAAG,GAC3BN,SAAWL,IACLS,EAAKG,WAAaH,EAAKG,UAAUC,UAC9BD,UAAUC,MAAMC,WAAad,MAInCS,EAAKI,UACHA,MAAQ,MAGVA,MAAM,uBAA0Bb,GAAae,KAAKL,MAAMX,OAAOC,OC9C1E,MAAMgB,EAAwC,CAAC,wBAAyB,iBAOxE,MAAeC,EAAgB,CAC7BC,KAAM,YACNC,OAAMC,GAAGC,MAAEA,KACF,iBACCC,eAAoCC,4BAAe,IACtDrB,QAAQsB,UACDN,EAAQM,EAAMC,KAAmBP,aAClCA,GAGEF,EAAsCU,QAAQR,IAAS,KAE/DhB,QAAQsB,KAAYA,IACpBG,KAAKH,IACG,CACLA,MAAAA,EACArB,IAAKQ,EAAmB,GAAG,OAG3BiB,EAAkBN,EAAMO,OAAS,GAAGP,EAAM,GAAGnB,KAAO,KAAO,GAC3D2B,EAASC,EACbC,EACA,CAAElB,WAAYc,EAAiBK,MAAO,2CAA4CC,MAAO,UAAWC,OAAO,EAAMC,iBAAiB,GAClI,CAAEb,QAAS,IAAMD,EAAMK,KAAKU,mBAAWC,EAAM,CAAEpB,KAAMmB,EAAKlC,IAAKoC,MAAO,GAAG,WAAKf,MAAMX,gBAAO2B,SAAW,kBAElGC,EAAYV,EAChBW,EACA,CAAE5B,WAAYc,EAAiBK,MAAO,oBAAqBU,UAAU,GACrE,CACEpB,QAAS,IACPD,EAAMK,KAAKU,GACTN,EACEa,EACA,CAAE1B,KAAMmB,EAAKlC,IAAK8B,MAAO,oBACzB,CACEV,QAAS,WAODsB,EAAgBR,EAAKb,MAAMsB,gBAC5BD,GAAaA,EAAStB,SAGpBsB,EAAStB,WAFP,mBAULwB,KAAa,CAACjB,EAAQW,IACjCV,EAAEiB,EAAO,GAAI,CAAEzB,QAAS,IAAM,CAACO,EAAQW"}
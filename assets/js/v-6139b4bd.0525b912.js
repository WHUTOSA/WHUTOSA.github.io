(self.webpackChunk=self.webpackChunk||[]).push([[591],{461:(n,s,a)=>{"use strict";a.r(s),a.d(s,{data:()=>t});const t={key:"v-6139b4bd",path:"/redisson/02-%E9%80%9A%E7%94%A8%E5%AF%B9%E8%B1%A1%E6%A1%B6/",title:"通用对象桶",lang:"ZH-cn",frontmatter:{title:"通用对象桶",type:"book",scopePath:"/redisson",sort:2},excerpt:"",headers:[{level:2,title:"本文目标",slug:"本文目标",children:[]},{level:2,title:"RBucket 接口的使用",slug:"rbucket-接口的使用",children:[]},{level:2,title:"源码阅读",slug:"源码阅读",children:[{level:3,title:"RedissonBucket",slug:"redissonbucket",children:[]},{level:3,title:"RedissonExpirable",slug:"redissonexpirable",children:[]},{level:3,title:"RedissonObject",slug:"redissonobject",children:[]}]},{level:2,title:"总结",slug:"总结",children:[]}]}},985:(n,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>ns});var t=a(252);const e=a.p+"assets/img/3.d35a5ee4.png",c=(0,t.Wm)("h1",{id:"通用对象桶",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#通用对象桶","aria-hidden":"true"},"#"),(0,t.Uk)(" 通用对象桶")],-1),o=(0,t.Wm)("h2",{id:"本文目标",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#本文目标","aria-hidden":"true"},"#"),(0,t.Uk)(" 本文目标")],-1),l=(0,t.Wm)("p",null,[(0,t.Uk)("掌握 "),(0,t.Wm)("code",null,"RBucket"),(0,t.Uk)(" 的使用，阅读相关源码并探究设计思路。")],-1),m=(0,t.Wm)("h2",{id:"rbucket-接口的使用",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#rbucket-接口的使用","aria-hidden":"true"},"#"),(0,t.Uk)(),(0,t.Wm)("code",null,"RBucket"),(0,t.Uk)(" 接口的使用")],-1),p=(0,t.Wm)("p",null,[(0,t.Uk)("Redisson 提供了用于存放任意类型对象的 "),(0,t.Wm)("code",null,"RBucket"),(0,t.Uk)(" 接口，接口的 JavaDoc 中将其描述为 "),(0,t.Wm)("code",null,"Object holder"),(0,t.Uk)("。")],-1),u=(0,t.Wm)("p",null,"Bucket 这一概念可能来源于云计算领域，不过既然是使用 redis，归根结底就是将对象序列化之后存放在 redis 中。",-1),k=(0,t.Wm)("p",null,[(0,t.Wm)("code",null,"RBucket"),(0,t.Uk)(" 接口的继承关系如下图所示：")],-1),W=(0,t.Wm)("p",null,[(0,t.Wm)("img",{src:"data:image/png;base64,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",alt:" 接口的继承关系"})],-1),i=(0,t.Wm)("p",null,[(0,t.Uk)("从中我们可以看到 "),(0,t.Wm)("code",null,"RObject -> RExpirable -> RBucket -> RBinaryStream"),(0,t.Uk)(" 的继承链条，也可以窥见 Redisson 对同步、异步的设计思路：所有同步操作类均继承自对应的异步操作类，实现了各种异步操作之后，同步操作只需在异步操作的基础上进行阻塞即可。")],-1),r=(0,t.Wm)("p",null,[(0,t.Uk)("分别点进 "),(0,t.Wm)("code",null,"RBucket"),(0,t.Uk)(" 和 "),(0,t.Wm)("code",null,"RBucketAsync"),(0,t.Uk)(" 接口的源码，可以发现两者分别定义了一一对应的同步和异步操作方法。例如，"),(0,t.Wm)("code",null,"RBucket"),(0,t.Uk)(" 中定义了同步方法 "),(0,t.Wm)("code",null,"V getAndDelete()"),(0,t.Uk)("，而 "),(0,t.Wm)("code",null,"RBucketAsync"),(0,t.Uk)(" 中则有对应的异步方法 "),(0,t.Wm)("code",null,"RFuture<V> getAndDeleteAsync()"),(0,t.Uk)("。所有异步方法的返回值都是 "),(0,t.Wm)("code",null,"RFuture"),(0,t.Uk)("，其包裹的值类型与同步方法对应。"),(0,t.Wm)("code",null,"RFuture"),(0,t.Uk)(" 继承了 Java 并发包中的 "),(0,t.Wm)("code",null,"Future"),(0,t.Uk)(" 接口和 "),(0,t.Wm)("code",null,"CompletionStage"),(0,t.Uk)(" 接口，可以相信其用法应与 "),(0,t.Wm)("code",null,"CompletableFuture"),(0,t.Uk)(" 相近。")],-1),d=(0,t.Wm)("p",null,[(0,t.Wm)("code",null,"RBucket"),(0,t.Uk)(" 接口提供的所有方法都具有原子性，下表列出了接口内全部的方法（不含父接口方法）：")],-1),U=(0,t.Wm)("table",null,[(0,t.Wm)("thead",null,[(0,t.Wm)("tr",null,[(0,t.Wm)("th",{style:{"text-align":"center"}},"方法"),(0,t.Wm)("th",{style:{"text-align":"center"}},"作用"),(0,t.Wm)("th",{style:{"text-align":"center"}},"入参含义")])]),(0,t.Wm)("tbody",null,[(0,t.Wm)("tr",null,[(0,t.Wm)("td",{style:{"text-align":"center"}},"long size()"),(0,t.Wm)("td",{style:{"text-align":"center"}},"获取对象的大小（字节）"),(0,t.Wm)("td",{style:{"text-align":"center"}})]),(0,t.Wm)("tr",null,[(0,t.Wm)("td",{style:{"text-align":"center"}},"V get()"),(0,t.Wm)("td",{style:{"text-align":"center"}},"获取对象"),(0,t.Wm)("td",{style:{"text-align":"center"}})]),(0,t.Wm)("tr",null,[(0,t.Wm)("td",{style:{"text-align":"center"}},"V getAndDelete()"),(0,t.Wm)("td",{style:{"text-align":"center"}},"获取对象并删除"),(0,t.Wm)("td",{style:{"text-align":"center"}})]),(0,t.Wm)("tr",null,[(0,t.Wm)("td",{style:{"text-align":"center"}},"boolean trySet(V value)"),(0,t.Wm)("td",{style:{"text-align":"center"}},"若对象桶为空（也就是 key 不存在），设置为指定对象；返回是否设置成功"),(0,t.Wm)("td",{style:{"text-align":"center"}},"待设置的新值")]),(0,t.Wm)("tr",null,[(0,t.Wm)("td",{style:{"text-align":"center"}},"boolean trySet(V value, long timeToLive, TimeUnit timeUnit)"),(0,t.Wm)("td",{style:{"text-align":"center"}},"若对象桶为空，设置为指定对象，并设置过期时间；返回是否设置成功"),(0,t.Wm)("td",{style:{"text-align":"center"}},"待设置的新值；过期时间；过期时间单位")]),(0,t.Wm)("tr",null,[(0,t.Wm)("td",{style:{"text-align":"center"}},"boolean setIfExists(V value)"),(0,t.Wm)("td",{style:{"text-align":"center"}},"若对象桶非空，设置为指定对象；返回是否设置成功"),(0,t.Wm)("td",{style:{"text-align":"center"}},"待设置的新值")]),(0,t.Wm)("tr",null,[(0,t.Wm)("td",{style:{"text-align":"center"}},"boolean setIfExists(V value, long timeToLive, TimeUnit timeUnit)"),(0,t.Wm)("td",{style:{"text-align":"center"}},"若对象桶非空，设置为指定对象，并设置过期时间；返回是否设置成功"),(0,t.Wm)("td",{style:{"text-align":"center"}},"待设置的新值；过期时间；过期时间单位")]),(0,t.Wm)("tr",null,[(0,t.Wm)("td",{style:{"text-align":"center"}},"boolean compareAndSet(V expect, V update)"),(0,t.Wm)("td",{style:{"text-align":"center"}},"以 CAS 方式设置对象；返回是否设置成功"),(0,t.Wm)("td",{style:{"text-align":"center"}},"待匹配的原值；待设置的新值")]),(0,t.Wm)("tr",null,[(0,t.Wm)("td",{style:{"text-align":"center"}},"V getAndSet(V newValue)"),(0,t.Wm)("td",{style:{"text-align":"center"}},"获取对象的原值并设置为新的值"),(0,t.Wm)("td",{style:{"text-align":"center"}},"待设置的新值")]),(0,t.Wm)("tr",null,[(0,t.Wm)("td",{style:{"text-align":"center"}},"V getAndSet(V value, long timeToLive, TimeUnit timeUnit)"),(0,t.Wm)("td",{style:{"text-align":"center"}},"获取对象的原值，然后设置为新的值并设置过期时间"),(0,t.Wm)("td",{style:{"text-align":"center"}},"待设置的新值；过期时间；过期时间单位")]),(0,t.Wm)("tr",null,[(0,t.Wm)("td",{style:{"text-align":"center"}},"void set(V value)"),(0,t.Wm)("td",{style:{"text-align":"center"}},"设置对象的值"),(0,t.Wm)("td",{style:{"text-align":"center"}},"待设置的新值")]),(0,t.Wm)("tr",null,[(0,t.Wm)("td",{style:{"text-align":"center"}},"void set(V value, long timeToLive, TimeUnit timeUnit)"),(0,t.Wm)("td",{style:{"text-align":"center"}},"设置对象的值及过期时间"),(0,t.Wm)("td",{style:{"text-align":"center"}},"待设置的新值；过期时间；过期时间单位")]),(0,t.Wm)("tr",null,[(0,t.Wm)("td",{style:{"text-align":"center"}},"void setAndKeepTTL(V value)"),(0,t.Wm)("td",{style:{"text-align":"center"}},"设置对象的值，并保留原有的 TTL（也就是不刷新过期时间）；需要 6.0.0 以上版本的 redis"),(0,t.Wm)("td",{style:{"text-align":"center"}},"待设置的新值")]),(0,t.Wm)("tr",null,[(0,t.Wm)("td",{style:{"text-align":"center"}},"int addListener(ObjectListener listener)"),(0,t.Wm)("td",{style:{"text-align":"center"}},"添加事件监听器，返回监听器 ID"),(0,t.Wm)("td",{style:{"text-align":"center"}},[(0,t.Uk)("事件监听器，支持过期（"),(0,t.Wm)("code",null,"ExpiredObjectListener"),(0,t.Uk)("）、删除（"),(0,t.Wm)("code",null,"DeletedObjectListener"),(0,t.Uk)("）、修改（"),(0,t.Wm)("code",null,"SetObjectListener"),(0,t.Uk)("）三种事件")])])])],-1),b=(0,t.Wm)("p",null,[(0,t.Uk)("可以看到，除了基本的读写能力之外，"),(0,t.Wm)("code",null,"RBucket"),(0,t.Uk)(" 还提供了 "),(0,t.Wm)("code",null,"getAndDelete"),(0,t.Uk)("、"),(0,t.Wm)("code",null,"compareAndSet"),(0,t.Uk)("、"),(0,t.Wm)("code",null,"getAndSet"),(0,t.Uk)(" 等实用的原子性操作，对开发者比较友好。")],-1),A=(0,t.Wm)("p",null,[(0,t.Uk)("而 "),(0,t.Wm)("code",null,"RBucketAsync"),(0,t.Uk)(" 接口中对应的异步方法，所有入参均与 "),(0,t.Wm)("code",null,"RBucket"),(0,t.Uk)(" 中对应的同步方法一致，方法名则为对应同步方法加上 "),(0,t.Wm)("code",null,"Async"),(0,t.Uk)(" 后缀。")],-1),g=(0,t.Wm)("p",null,[(0,t.Wm)("code",null,"RBucket"),(0,t.Uk)(" 的使用非常简单，通过 "),(0,t.Wm)("code",null,"RedissonClient"),(0,t.Uk)(" 对象创建 "),(0,t.Wm)("code",null,"RBucket"),(0,t.Uk)(" 实例后，就直接愉快地调用。")],-1),y=(0,t.Wm)("p",null,[(0,t.Uk)("下面是使用 "),(0,t.Wm)("code",null,"RBucket"),(0,t.Uk)(" 模拟 CAS 并发计数的示例代码：")],-1),E=(0,t.Wm)("blockquote",null,[(0,t.Wm)("p",null,[(0,t.Uk)("这个小 DEMO 仅是为了展示 "),(0,t.Wm)("code",null,"RBucket"),(0,t.Uk)(" 的 API 使用方法，实际开发中我们当然不会直接用 "),(0,t.Wm)("code",null,"RBucket"),(0,t.Uk)(" 来做计数，且不说直接使用 Redisson 提供的 "),(0,t.Wm)("code",null,"RAtomicLong"),(0,t.Uk)(" 接口更加方便（性能也好得多），更重要的是计数类需求常常需要做多级收集（例如使用二级缓存队列），并且在数据量特别大时还需要改用概率估计。从控制台输出也能看到各线程 CAS 的过程需要反复重试，并发量更大时甚至可能出现活锁。")])],-1),f=(0,t.Wm)("div",{class:"language-java ext-java line-numbers-mode"},[(0,t.Wm)("pre",{class:"language-java"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token annotation punctuation"},"@SpringBootTest"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("classes "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"TestApplication"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token keyword"},"class"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"public"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"class"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"BaseTest"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token annotation punctuation"},"@Autowired"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"protected"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"RedissonClient"),(0,t.Uk)(" redissonClient"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n    "),(0,t.Wm)("span",{class:"token annotation punctuation"},"@Autowired"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"protected"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"RedisTemplateBuilder"),(0,t.Uk)(" redisTemplateBuilder"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n"),(0,t.Wm)("span",{class:"token keyword"},"public"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"class"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"BucketTest"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"extends"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"BaseTest"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"private"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"static"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"final"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"String"),(0,t.Uk)(" KEY_NAME "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},'"testBucket"'),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n    "),(0,t.Wm)("span",{class:"token annotation punctuation"},"@Test"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"void"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"testCompareAndSet"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"throws"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"InterruptedException"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token class-name"},"RBucket"),(0,t.Wm)("span",{class:"token generics"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Wm)("span",{class:"token class-name"},"Long"),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)(" bucket "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" redissonClient"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"getBucket"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("KEY_NAME"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"new"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"TypedJsonJacksonCodec"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"Long"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token keyword"},"class"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n        bucket"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"set"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token number"},"0L"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n        "),(0,t.Wm)("span",{class:"token class-name"},"List"),(0,t.Wm)("span",{class:"token generics"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Wm)("span",{class:"token class-name"},"Thread"),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)(" threads "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"new"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"LinkedList"),(0,t.Wm)("span",{class:"token generics"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token class-name"},"IntStream"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"range"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token number"},"0"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"10"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"forEach"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("threadI "),(0,t.Wm)("span",{class:"token operator"},"->"),(0,t.Uk)("\n                threads"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"add"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"new"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"Thread"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"->"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n                    "),(0,t.Wm)("span",{class:"token keyword"},"for"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"int"),(0,t.Uk)(" countI "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"0"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(" countI "),(0,t.Wm)("span",{class:"token operator"},"<"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"50"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(" countI"),(0,t.Wm)("span",{class:"token operator"},"++"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n                        "),(0,t.Wm)("span",{class:"token comment"},"// 这里的读、写过程不具有原子性，多个线程反复CAS尝试，性能较差，但最终结果是正确的"),(0,t.Uk)("\n                        "),(0,t.Wm)("span",{class:"token class-name"},"Long"),(0,t.Uk)(" oldSum "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" bucket"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"get"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n                        "),(0,t.Wm)("span",{class:"token keyword"},"while"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token operator"},"!"),(0,t.Uk)("bucket"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"compareAndSet"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldSum"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" oldSum "),(0,t.Wm)("span",{class:"token operator"},"+"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"1"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n                            "),(0,t.Wm)("span",{class:"token class-name"},"System"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("out"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"println"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"String"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"format"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},'"%s - T%s - %s->%s CAS失败"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"LocalDateTime"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"now"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"Thread"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"currentThread"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"getName"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" oldSum"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" oldSum "),(0,t.Wm)("span",{class:"token operator"},"+"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"1"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n                            oldSum "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" bucket"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"get"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n                        "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n                        "),(0,t.Wm)("span",{class:"token class-name"},"System"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("out"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"println"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"String"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"format"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},'"%s - T%s %s -> %s"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"LocalDateTime"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"now"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" threadI"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" oldSum"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" oldSum "),(0,t.Wm)("span",{class:"token operator"},"+"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"1"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n                    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n                    "),(0,t.Wm)("span",{class:"token class-name"},"System"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("out"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"println"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"String"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"format"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},'"T%s finished"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" threadI"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n                "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},'""'),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"+"),(0,t.Uk)(" threadI"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n        "),(0,t.Wm)("span",{class:"token class-name"},"LocalDateTime"),(0,t.Uk)(" start "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"LocalDateTime"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"now"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n        threads"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"forEach"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"Thread"),(0,t.Wm)("span",{class:"token operator"},"::"),(0,t.Wm)("span",{class:"token function"},"start"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token comment"},"// 主线等待所有子线程执行完毕"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"for"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"Thread"),(0,t.Uk)(" thread "),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" threads"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n            thread"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"join"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token class-name"},"System"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("out"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"println"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"String"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"format"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("\n                "),(0,t.Wm)("span",{class:"token string"},'"最终结果 %s 总耗时 %s"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n                bucket"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"get"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n                "),(0,t.Wm)("span",{class:"token class-name"},"Duration"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"between"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("start"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"LocalDateTime"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"now"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"toMillis"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n        bucket"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"delete"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])]),(0,t.Wm)("div",{class:"line-numbers"},[(0,t.Wm)("span",{class:"line-number"},"1"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"2"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"3"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"4"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"5"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"6"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"7"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"8"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"9"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"10"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"11"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"12"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"13"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"14"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"15"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"16"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"17"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"18"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"19"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"20"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"21"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"22"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"23"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"24"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"25"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"26"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"27"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"28"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"29"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"30"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"31"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"32"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"33"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"34"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"35"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"36"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"37"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"38"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"39"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"40"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"41"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"42"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"43"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"44"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"45"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"46"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"47"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"48"),(0,t.Wm)("br")])],-1),R=(0,t.Wm)("p",null,"再试一下监听器：",-1),I=(0,t.Wm)("blockquote",null,[(0,t.Wm)("p",null,[(0,t.Uk)("需要开启 "),(0,t.Wm)("code",null,"notify-keyspace-events"),(0,t.Uk)("。")])],-1),h=(0,t.Wm)("div",{class:"language-java ext-java line-numbers-mode"},[(0,t.Wm)("pre",{class:"language-java"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token annotation punctuation"},"@Test"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"void"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"testListener"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"throws"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"InterruptedException"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token class-name"},"RBucket"),(0,t.Wm)("span",{class:"token generics"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Wm)("span",{class:"token class-name"},"String"),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)(" bucket "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" redissonClient"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"getBucket"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("KEY_NAME"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"new"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"TypedJsonJacksonCodec"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"String"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token keyword"},"class"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n    bucket"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"addListener"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"SetObjectListener"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(" name "),(0,t.Wm)("span",{class:"token operator"},"->"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"System"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("out"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"println"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},'"set"'),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    bucket"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"addListener"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"DeletedObjectListener"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(" name "),(0,t.Wm)("span",{class:"token operator"},"->"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"System"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("out"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"println"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},'"delete"'),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n    "),(0,t.Wm)("span",{class:"token keyword"},"for"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"int"),(0,t.Uk)(" i "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"0"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(" i "),(0,t.Wm)("span",{class:"token operator"},"<"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"5"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(" i"),(0,t.Wm)("span",{class:"token operator"},"++"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        bucket"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"set"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},'"hello"'),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    bucket"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"delete"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n    "),(0,t.Wm)("span",{class:"token class-name"},"Thread"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"sleep"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token number"},"1_000"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])]),(0,t.Wm)("div",{class:"line-numbers"},[(0,t.Wm)("span",{class:"line-number"},"1"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"2"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"3"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"4"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"5"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"6"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"7"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"8"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"9"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"10"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"11"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"12"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"13"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"14"),(0,t.Wm)("br")])],-1),w=(0,t.Wm)("h2",{id:"源码阅读",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#源码阅读","aria-hidden":"true"},"#"),(0,t.Uk)(" 源码阅读")],-1),C=(0,t.Wm)("p",null,[(0,t.Uk)("Redisson 提供了三个直接或间接实现了 "),(0,t.Wm)("code",null,"RBucket"),(0,t.Uk)(" 接口的实现类，分别是 "),(0,t.Wm)("code",null,"RedissonBucket"),(0,t.Uk)("、"),(0,t.Wm)("code",null,"RedissonTransactionalBucket"),(0,t.Uk)(" 和 "),(0,t.Wm)("code",null,"RedissonBinaryStream"),(0,t.Uk)("。")],-1),B=(0,t.Wm)("p",null,[(0,t.Wm)("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAlgAAADjCAIAAADWlv0UAAAYDElEQVR42u2dXXPbxrmA+3tqJ/bEdhxP/EFSsmQrjiTLthLaEiknjj9SR4jbi6YXimfKVvaUM00ypj3DsqfpDWeUO14pd+dO+Unn+rzkEtBisViAECmBxPPMjocCQGK53HcfvIsl/btTAAAABeZ3NAEAACBCAAAARAgAAIAIAQAAECEAAAAiBAAAQIQAAACIEAAAABECAAAgQgAAAEQIAACACAEAABAhAAAAIgQAAECEAAAAiBAAAAARAgAAIEIAAABECAAAgAihcHwHKaCfACBCmGURrnxSpjgKIgRAhIAIESEAIEJAhIgQABAhIEJECACIEBAhIgQARAiIEBECACIERIgIAQARwgyKcHW1fO95ufqyfP91RYo8kD9l41T7bLvV2+vu1pdKiBAAEQK4RHinXr7/qvKgaRbZKLvGaKblJa/ZPfjl199U2et2dmqlmF29plc9sggPECEAIgRIEKGoLqpAvYzRhX3b7R+0G9XB4+p2o7e331MujO4SHTa9EiIEAEQIExTh6qo9FzTyQmOO9N6zysYPlY0fK+vfVDKLUAlvp3uw1/Jsu/p/ql2IEAARAkxKhPeeh9LB86XfB0XfLofpnhAFrq2Xb98tb7yZrAiDBLF/mK80/VnDg2tes9vTplWHR+oiDMwaeLHuddr+ZGy7FXpxRAiACKEoIqy+NOdF52rnpBgb5bCQCN/OqQebbyciwsisqUuEy15nYDIvmvkFIuyb0rCgev3BbUjZa5gVEQIgQiiKCKPzolYRymG6YDbfzSkLGuXo9wiDrK7vtkY1ZD6bCKPZoUWEtd22Zt/gXPoNSLFpUBNECIAIAREmiDBIB7OJ8HAOcz+8alRPFmuH9whdIhxILm5NjYgwcGqoGoNn6dIdVAYRAiBCKJ4Is02NHlGEw4xwMKUZOMwQoZGlhe/2jSDC/jc0Wj3Dhe5nIUIARAgFEmG2xTJjEeFQVPud7aWSVYSD23jDvbEiTDM1ulSqN0IuTFySiggBECEURYTZvj4xLhGGbxmGdtW9ftJmrIhRX7HPsFhGaVVPQId/+rchESEAIoSCivAEv1BvpH2WX5ZphNxWb3SCG3uyNzzVaXx9wpJH+gno4Y1A/esTxtwpIgRAhFAgER7nT6zxo9sAgAghjyKc1R/dRoQAiBAgrQgpiBAAEQIipCBCAEQIiJCCCAEQISBCREg/AUCEgAgRIQAgQkCEiBAAECHMngghEfoJACIESGDu/mWqBACIEArKxcq5rTer8i9VAgBECEVk7c8LYh35lyoBACKEgqaDquQkA8thlQAAEcKMp4Oq5CQDy2GVAAARwuyngznJwHJYJQBAhFCIdDAnGVgOqwQAiBCKkg6eeAaWwyoBACKEAqWDJ56B5bBKAIAIoVjp4AlmYDmsEgAgQihcOniCGVgOqwQAiBCKmA6eSAaWwyoBACKEAiGayVuVFupX+VwAECFAcUWYwyoBACIERIgIAQARAiJEhACACAERIkIAQISACBEhACBCQISTgVWjAIgQgPQLABAhABkhACBCgAKKkCQVABECIEIAQIQAiBAAECEAIgQARFjQ0ZlybCWHn75aLyP/GlVl+yS2AyBC0hQAAECEiBCgeJARAiJEhAAEGgAiJD4BCDQAREh8AhBoAIiQ+AQg0AAQIfEJQKABIELiE6AIsGoUECEiBAAARIgIAcgIARAhIgQg0AAQIfEJQKABIELiE4BAA0CExCcAgQaACIlPAAINABESnwCzC6tGAREiQgAAQISIEICMEAARIkIAAg0AERKfAAQaACIkPgEINABESHwCEGgAiJD4BCDQABDhCcFiNgACDRDhId9BMSBOjpm1tTV6XcGRPkAgTI0IVz4pU2a7IMITEeHq8k36XmHL2gACARFSECEipPshQkCEFESICCmIEBAhBREiQgoiBERIQYSIkIIIARFSECEipCBCQIQURIgIKYgQci3C1dXyvefl6svy/dcVKfJA/pSNdG5ECEcU4fLqzaXnL268/OfC639LkQfyp2zMYbdZXqrutHp7LW+2o2Nb3mN3t75UQoSI8LDcqZfvv6o8aJpFNsqusYaZ1+we/PLrb6rsdTs7tVLMrl7Tq+YwhOqNTnt/WM+2Vv/+W6jtyltoeiVEiAiDcqu+tfCqs9D8r1ledWTX8QTXaCLsHuRKhJMYGbZbB9lE6I5xRDjFIhTVRRWolzG6sN+n9w/ajaoKue1Gb2+/p8I1uks6vd7hlr3OIAzGfx03igUHFfb8SrZ6oRrWdsWRiBARhizY/NliwWH5eYwudATXUUR44nGXODIcswgdMY4Ip1WEq6v2XNDIC4050nvPKhs/VDZ+rKx/U8ncp42oi+zq/5m3KRp3/CBCRKiLcHn1pj0XDOeFxhzpJIJr6jPCcY8MiBARhkR473koHTxf+n1Q9O1ymP55S5SurZdv3y1vvJmsCP3LwP5jf2LE7L6SpbX9mRO5BG42qvrpdrRd7ZYXPHeQz3Xa3d7hlMtgbzTM5Io4uLLux89+ZzsSP+qNBC9lVDXuXMP6e52g/u3WrlZDe+X7oTjY3n+zrY6aNWpHxgVEeOIiXHr+IhDe/D/+c+nRH88urp4pL55f26i8/CnYJYdNOriSepqkWcMJ/71ur70fCsm4uFMzIsFtAj37dOzSby4Y0RoXyM6RYfAetUAz09ma19Tjzj9SF2EQ8u6QdMc4IpxuEVZfmvOic7VzUoyNclgoVt/OqQebbyciwriJHet1nL6xPpjGsV6v1b3+pVwknDz71aJmu1DMDK4H97qd7Vo1/dWi41yhudaaF3cxrld+2X+P+oNoWyHCExdhf3WMb7tLj15cWH8497d38687V/7UmP97O9glh006uNw9bdjha8MeHs23rHFXj596TblLxUtQ4bhAdt5PcYlQBYh++Rt9R31TGhZ0hiQZ4WyKMDovahWhHKZ/3pvv5lSgGuXo9wj1qy05zOE860bHxI4ZJOFRI3RkKAgj15j+1W70pn2SCKvW7cZ9UOsIErpiCPznn856XkR44iLU50XPLq7MNd7FzY4eT3BZe1qaCdXYuPP1ab+UrCUHwsA6w4vOuEB2jAwOEbrneIfnCps4TUgiQkRofuqZY/VwYmE/vGpUD8ial/LK1BI/oTnJXsx0ZbwItdnReLcNb9qHomhUEQ6ONydbtKtda+UR4dSK8G0aEU4kuOJ7mtF50oswmCpst3aNCZK4XdGOat53sAWyY2RwidBpLDlX4NT0IYkImRotjzFWjSm+OFtE06NRRRia8zFjJlaE+oWqfsWaOImaTYSOWLVWHhFO59Totxfu1cWF87v/uuJ9X/5LM25qdCLBFd/TMovQf/rw/mL02xrRXWMRYfKz0omwX6tW2mtZpkZZLGNZLDOWWDVE4p42ySBC+5xPOhH6dy889wo6o4bZpkZjJnJjK78cuQ+KCPO/WOZ6f7HMt2cXl9+v3LiwvjX317dxi2UmF1wj9LTUIrQGV9yukadGsz0r/dTo4EpXd2HiklREOJsizPb1iXHFanRpaLBLLQ8xeqT1FlpCRtjNkhEGkyeRlLSz48VO3vqxF51Eij2XisNm5G6oo/KIcFpEmO3rE5MILndPM74dG/WHNe7qjU7T8+/VhReVOHelWizjEKExMvjhUM22WOawZbxSYkM5YhwRTrcIT/AL9cbFneX3Ixqe5baEf9tM+rH7QtI4frg0PPgSQpII/QWioR7fX/kd830M/YcnjBomTMNqa7XDF6f2yiPCaRHhCX6h3jpjEdfThrsOvynRM++c2eLOfDXNDY5djq9PuEToHBn0H3syKh/5+oQlj/Sz50PTOxoqLsYR4dSL8Dh/Ym2KSnT9GL81CqOK8Dh/Yo3Cj24jwiOJkB/dtiwKzfrbE4gQEU7vj25TEGGhRUgx1k+3W1NsQUSYKxFSECEgQgoiRIQURAiIkIIIESEFEQIipCBCREhBhIAIKYgQEVIQISBCCiJEhBRECCcoQigCxMnxi5BeV3AQ4dSIsIDM3b9MI8DMU6q/ogXoBogQLFysnNt6syr/0hQww1y4Xv38f/5P/qUF6AyIEEzW/rwgIpR/aQqYYW59/7+iAfmXFqAzIEKwpIOqkBTCbCdDqhQzJaIFECEkpIOqkBTCbCdDqhQzJaIFECEkp4MkhVCEZKiYKREtgAghVTpIUghFSIaKmRLRAogQ0qaDJIVQhGSoaCkRLYAIYYR0kKQQipAMFS0logUQIYyWDpIUQhGSoeKkRLQAIoSR00GSQihCMlSclIgWQISQJR0kKYQiJENFSIloAUQIIyDmoxFg5pFxnxagGyBCQISABmgBQISACAEN0AKACAERAhqgBQARAiIENEALACKEU6cW6ldpBEADtAAgQgBAA7QAIEIyQgA0QAsAIiwa3CMENEALACJEhABogBYARIgIAdAALQCIEBECoAFaABAhIgRAA7QAIMLCwKrRSYw4lBwWuiWxiQgBGHGAbgmIEMgIGXGAbgmIEHS4R8iIA3RLQISIEBhxgG4JiBARAiMO0C0BESJCYMQBuiUgQkQIjDhAtwREWBhYNcqIA3RLQIQAjDhAtwRESEYIjDhAtwREWEC4R8iIA3RLQISIEBhxgG4JiBARAiMO0C0BESJCYMQBuiUgQkQIjDhAtwREWBhYNcqIA3RLQIQAjDhAtwRESEYIjDhAtwREWEC4R8iIA3RLQISIEBhxgG4JiBARAiMO0C0BESJCYMQBuiUgQkQIjDhAtwREWBhYNTp2Ko9+ohGAbgmI8NR3ALmHHg4wk+GZIxGufFKmUHJbji5C2pBCyWd4IkIKBRFSKIgQEVIoiJBCQYSIkEJBhBQKIkSEFAoipFAQISKkUBAhhYIIESGFgggpFER4wiJcXr259PzFjZf/XHj9bynyQP6UjTn8GJaXqjut3l7Lo0cSafRwyrSU5SWvuX/wy6+/Sdnr7taXShM93bZ0ocmcZWZFeKu+tfCqs9D8r1ledWTXmLtCd9gVBr2hs1MrZRkmuge5GiYi76vX9Ko5DMV6o9P2Q7Edbvzl2q68haZXmkkR0sOP+r68TvCm9JKTDpPqLeSmh2+3DgxFTWIAiZ5lXA01myLsjxHNny1jxLD8PMaRQl0TtRtVFe3bjd7efm/UkSI6TKgoPYaLrPTvyxgjTryGAwsOWtvzK9nqhWpY2xVHzqQI6eFjN+IU+S9NDz/m5rWL0DmAHLMI3UPBDIpwefWm/Uo5fNVszCDde1bZ+KGy8WNl/ZtK5mEi85VvTjPC0Pvq/5m3qS13YMyqCOnhiDBvPdwtwnENIIhwhGFi6fmLYDiY/8d/Lj3649nF1TPlxfNrG5WXPwW75DC9IWSAWFsv375b3ngz5mGi7nXa/hRBu3X4KQ6ukobTenvdXtvvJe5pd5X3BJOB+rW5Y5c+hSjbm42qnlQF1dN3Wfuxf33nqmHcC6on7mi72i0v1Botaaje4VzKYG80fmTYCt5aPzD2O9uRwFCfgjHlFVQ17lxJn5e98v0Y6/oN2+qo6aB2JODHKEJ6+Fh6uFuEjk7i6MbOzu94X7EvOOhgXlOvxqDFHD088b5dhoZy1zC9CIMEsd+FtHg0Zwtsb9k4SzAyuCPXPRTMsgj7awf8seDSoxcX1h/O/e3d/OvOlT815v/eDnbJYaFh4u2cerD5dpzDRGjurubpu4aDeG04mEYvl6yXP/X4iamUu9TFUVBh/Sx1bURIMyFmrWHcC5pV8kLV8E/n2S8DNduFgmHwXva60ozV9JeBjnM5Pq+4ygfDqP4g2lZjFCE9fCw9PEmEsZ3E0Y0d56qnm1I242LwIlHxpEl0Ept31Iay1jD91OjheZ0idLzl4Cx9UxoWdEZuETNCfdbo7OLKXONd3NyR3hCb7+bUGGGUo9xBUbuM+2pqb5rppljN+IOLXRi1knsg8zvNUC3hi6zDaujXlcOLrEY18TLQ8YLuubJoJa3jlOXi0b/Qjt6NTxJh1brd+nk5Kn/oP/901vOOUYT08LH08HQirI405es4l+N9xXatpPnkUUV4xIYa6aN0DCAOEbrf8vAsNdPEiZGLCGWYeJtmmAgulrMNE4dJ937HaH0zK1fDRPiDST9MBJm+5P5GGhS3K9oJzNlFo0dqEyyHA1nNS3lFH/eCgbRipivjRajNjsa7bXg3PhQeo4ow/vNyVD4HIqSHZ+nhmUXo6Mbuzu94X/aulTR8jyzCrA3leMtpp0a1AcQlwqR3FDg1feQWVIThiaNvL9yry0gxv/uvK9735b804yaOjjhMGLNkyWu6sg4T/tOHd1+ia9mju8YiQmt6NKoIQ3NlZjC4LsCD61b9AjZxEjWbCF3Diq3yxy9CevhYenhmETq6cfK5bO8rtmvlRoSOt5w++0w4VzoR9tutlfaSl8Uyw7Hgen8pwbdnF5ffr9y4sL4199e3cUsJxjJMGGOxY6FU5okjyxyF7Ri30hLmQ1I8K4MI7W85nQj9mxmee6bIqGG2qdERPq+wCN1RN6HFMvTwzD08mwjd3TjxXImVD+866anRFJE73mnYVFOjgwti3YWJS1L5+kTaxeXjGiaMP9UH1ozcXYt+B8566yJ6g6re6DQ9f6o9fE/YuSvVHXJH71d3yNPUMOG6spslIwxmRSIpaWfHi5289Vs1OvkWey7H5xVX+eMXIT18LD38SBlhd+SM0FF5V1y4F8vE9HBn82ZpKEcN487lHkD8Nq9mWyxz2PG0tUhx/TCxofhC/fi/bxfNS/RFvUZG3991uNC5Z058D36VKpiR3/ZXc4VeTftoHbsca6ZdIjR+GKLhWW7nRGqYcJukpa+K1r6EkCRCf4Fo5E05V3WrX5QwapgwDRvzecVV/vhFSA8fSw8/yj3CuG7sEmF85R0vaPsuQWhWxtrDHc2braHcNTRuIqpzJQ4g+m9CGX0j7i0beedgcuLQvo5+6G4ofmKNMmW/ajiN33qe9p9Yo1D4KWB+dJuSi59szvyjEvzoNoVCKa4IKbOgQH9hdLs1xRZc4b9holAQISKkEGn0cAoFESJCCpFGD6dQECEipBBp9HAKBREiQgqRRg+nUBAhIqQQafRwCqUAIvyDz9dff725ufnRRx9NSIQAOYceDjCT4ZlKhOrB6dOnr1+/XqvVTiprDGri2HKUVxvXKwMAwBQxggiF995779mzZ+rx2bNnP//88ydPnsi/Z86ckS1ffPHFuXPn5IFkjfKsS5cuyePz58/Ldnkgx3z22WdPnz5dX19///33gxdfWlpScrUeIGe5f/++nGV+ft4qwosXL25tbckxRh3kvA8fPgyOjG63qi7YGDyw1uratWtfD6jX6x9//DHdCACgECIUDdy4cePBgwfqz9XV1YWFBdm4uLh4+/Zt2bKysiIpozyQw8SXYjh5LMfIkWrvhx9+KCotl8vLy8vBi8tTlMOsB6ytrckryAHywCrCu3fvSh2uXr2q6vDpp5/K8fJAahW8iHV7ShFaayUKVO+0VCopzQMAwCyLUCFu29zcFCuo7V9++aUSmCRtjx49kgdiI0mb5IHkiCIeydLkcbVale3q+NOnT58aTLHK4+DF5enBC0YP+Oqrr9RZJJ+zilDleSIqVQdJQ9V5pQ5XrlwJjoxu/4OGQ4TWWslLSZp4+fJlOS99CACgKBmhgXhRGUJlSIGN5F+xl2RpT58+lX+fPHmiZhTleN2p0Re3HqBeWb24VYRKRVIT9RR5IHUQuT5+/Fi3VHR7yozQWit5HcmM5U95jxcvXqQbAQAUUYTiFWU4sYKYT22U/G9xcVGyJXksqrh161YwlSrHBOK0vrj1ANmoUsYPPvjAKkJ1i07cFqRra2trKysrqg46xvaUIrTWKnDz/Px88N4BAKBYIrx9+/bc3Jy6R3jnzh21cWFhQVIudf9saWlJcqabN28Gx0vyJPKQvZubm9EXtx4gG2/cuHHmzBl5YBWhHCl1uHbtWnAD7+rVq8E9PB1je0oRWmu1tbVVKpVEkGrVDN0IAKCIIlSrRp8+fSpZYHCf78KFC3L8+fPnTw1uy6lVncHxavllrVYLbjTqL249QCQnry9Zl0g3btXow4cP5YnBkk55ENw71DG2pxShtVby1ur1ulo4Ki6kGwEAzLIIp47Lly+LpdJvBwAARDhTPH78WK1TTbkdAAAQIQAAACIEAABAhAAAAIgQAAAAEQIAACBCAAAARAgAAIAIAQAAECEAAAAiBAAAmB3+H+X+MgeMD/+wAAAAAElFTkSuQmCC",alt:" 的子类"})],-1),x=(0,t.Wm)("p",null,[(0,t.Uk)("我们通过 "),(0,t.Wm)("code",null,"RedissonClient#getBucket"),(0,t.Uk)(" 方法获取的 "),(0,t.Wm)("code",null,"RBucket"),(0,t.Uk)(" 实例属于哪个类呢？打印下 "),(0,t.Wm)("code",null,"getClass"),(0,t.Uk)(" 就知道了：")],-1),Q=(0,t.Wm)("div",{class:"language-java ext-java line-numbers-mode"},[(0,t.Wm)("pre",{class:"language-java"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token annotation punctuation"},"@Test"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"void"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"printClass"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token class-name"},"System"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("out"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"println"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("redissonClient"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"getBucket"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},'"test"'),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"getClass"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])]),(0,t.Wm)("div",{class:"line-numbers"},[(0,t.Wm)("span",{class:"line-number"},"1"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"2"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"3"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"4"),(0,t.Wm)("br")])],-1),L=(0,t.Wm)("p",null,[(0,t.Uk)("运行后控制台打印出了 "),(0,t.Wm)("code",null,"class org.redisson.RedissonBucket"),(0,t.Uk)("。")],-1),S=(0,t.Wm)("h3",{id:"redissonbucket",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#redissonbucket","aria-hidden":"true"},"#"),(0,t.Uk)(),(0,t.Wm)("code",null,"RedissonBucket")],-1),j=(0,t.Wm)("p",null,[(0,t.Uk)("那就先看下 "),(0,t.Wm)("code",null,"RedissonBucket"),(0,t.Uk)(" 类的代码吧。")],-1),v=(0,t.Wm)("p",null,"点进去首先可以看到两个构造方法：",-1),P=(0,t.Wm)("div",{class:"language-java ext-java line-numbers-mode"},[(0,t.Wm)("pre",{class:"language-java"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token keyword"},"public"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"RedissonBucket"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"CommandAsyncExecutor"),(0,t.Uk)(" connectionManager"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"String"),(0,t.Uk)(" name"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"super"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("connectionManager"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" name"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n"),(0,t.Wm)("span",{class:"token keyword"},"public"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"RedissonBucket"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"Codec"),(0,t.Uk)(" codec"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"CommandAsyncExecutor"),(0,t.Uk)(" connectionManager"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"String"),(0,t.Uk)(" name"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"super"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("codec"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" connectionManager"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" name"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])]),(0,t.Wm)("div",{class:"line-numbers"},[(0,t.Wm)("span",{class:"line-number"},"1"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"2"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"3"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"4"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"5"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"6"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"7"),(0,t.Wm)("br")])],-1),D=(0,t.Wm)("p",null,[(0,t.Uk)("向父类追溯，可以看到 "),(0,t.Wm)("code",null,"codec"),(0,t.Uk)("、"),(0,t.Wm)("code",null,"connectionManager"),(0,t.Uk)("、"),(0,t.Wm)("code",null,"name"),(0,t.Uk)(" 这三个变量都是 "),(0,t.Wm)("code",null,"RedissonObject"),(0,t.Uk)(" 中的字段，其中 "),(0,t.Wm)("code",null,"codec"),(0,t.Uk)(" 是序列化、反序列化器，"),(0,t.Wm)("code",null,"name"),(0,t.Uk)(" 是待操作的目标 redis 键，至于 "),(0,t.Wm)("code",null,"CommandAsyncExecutor"),(0,t.Uk)(" 类变量 "),(0,t.Wm)("code",null,"connectionManager"),(0,t.Uk)("，从命名来看应该被用于执行异步命令。")],-1),T=(0,t.Wm)("p",null,[(0,t.Uk)("回到 "),(0,t.Wm)("code",null,"RedissonBucket"),(0,t.Uk)(" 类，再往下扫一眼，可以发现所有同步方法的形式都一模一样：")],-1),H=(0,t.Wm)("div",{class:"language-java ext-java line-numbers-mode"},[(0,t.Wm)("pre",{class:"language-java"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token annotation punctuation"},"@Override"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"public"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"V"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"get"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"get"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token function"},"getAsync"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n"),(0,t.Wm)("span",{class:"token annotation punctuation"},"@Override"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"public"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"V"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"getAndDelete"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"get"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token function"},"getAndDeleteAsync"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n"),(0,t.Wm)("span",{class:"token annotation punctuation"},"@Override"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"public"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"long"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"size"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"get"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token function"},"sizeAsync"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n"),(0,t.Wm)("span",{class:"token annotation punctuation"},"@Override"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"public"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"void"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"set"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"V"),(0,t.Uk)(" value"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token function"},"get"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token function"},"setAsync"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("value"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n"),(0,t.Wm)("span",{class:"token annotation punctuation"},"@Override"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"public"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"V"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"getAndSet"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"V"),(0,t.Uk)(" newValue"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"get"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token function"},"getAndSetAsync"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("newValue"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n"),(0,t.Wm)("span",{class:"token comment"},"// ……省略其它……"),(0,t.Uk)("\n")])]),(0,t.Wm)("div",{class:"line-numbers"},[(0,t.Wm)("span",{class:"line-number"},"1"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"2"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"3"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"4"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"5"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"6"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"7"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"8"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"9"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"10"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"11"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"12"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"13"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"14"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"15"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"16"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"17"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"18"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"19"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"20"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"21"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"22"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"23"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"24"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"25"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"26"),(0,t.Wm)("br")])],-1),O=(0,t.Wm)("p",null,[(0,t.Uk)("显然，这些同步方法都是先调用异步方法得到 "),(0,t.Wm)("code",null,"RFuture"),(0,t.Uk)(" 对象，然后再通过 "),(0,t.Wm)("code",null,"RedissonObject#get(RFuture<V> future)"),(0,t.Uk)(" 方法同步、阻塞地获取最终结果。如果想要验证，不妨打上断点调试一波，这里就不演示了。")],-1),F=(0,t.Wm)("p",null,[(0,t.Uk)("而异步方法实际上也大同小异，都是调用 "),(0,t.Wm)("code",null,"commandExecutor"),(0,t.Uk)(" 执行读写操作，其中一部分操作使用了 LUA 脚本来确保原子性，例如，"),(0,t.Wm)("code",null,"getAndSetAsync"),(0,t.Uk)(" 方法的代码如下：")],-1),N=(0,t.Wm)("div",{class:"language-java ext-java line-numbers-mode"},[(0,t.Wm)("pre",{class:"language-java"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token annotation punctuation"},"@Override"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"public"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"RFuture"),(0,t.Wm)("span",{class:"token generics"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Wm)("span",{class:"token class-name"},"V"),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"getAndSetAsync"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"V"),(0,t.Uk)(" newValue"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 当 newValue 为 null 时，通过 Lua 脚本获取对象桶 key 的值，然后将其删除，最后返回这个值"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("newValue "),(0,t.Wm)("span",{class:"token operator"},"=="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"null"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(" commandExecutor"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"evalWriteAsync"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token function"},"getRawName"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" codec"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"RedisCommands"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("EVAL_OBJECT"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n                "),(0,t.Wm)("span",{class:"token string"},"\"local v = redis.call('get', KEYS[1]); \""),(0,t.Uk)("\n                "),(0,t.Wm)("span",{class:"token operator"},"+"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"\"redis.call('del', KEYS[1]); \""),(0,t.Uk)("\n                "),(0,t.Wm)("span",{class:"token operator"},"+"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},'"return v"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n                "),(0,t.Wm)("span",{class:"token class-name"},"Collections"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"singletonList"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token function"},"getRawName"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 当 newValue 非空时，执行 redis 的 getset 命令"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(" commandExecutor"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"writeAsync"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token function"},"getRawName"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" codec"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"RedisCommands"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("GETSET"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"getRawName"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"encode"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("newValue"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])]),(0,t.Wm)("div",{class:"line-numbers"},[(0,t.Wm)("span",{class:"line-number"},"1"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"2"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"3"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"4"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"5"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"6"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"7"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"8"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"9"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"10"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"11"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"12"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"13"),(0,t.Wm)("br")])],-1),V=(0,t.Wm)("p",null,[(0,t.Wm)("code",null,"RedissonBucket"),(0,t.Uk)(" 类的其它方法，除了监听器相关的操作方法以外，基本上和 "),(0,t.Wm)("code",null,"getAndSet"),(0,t.Uk)(" 方法或 "),(0,t.Wm)("code",null,"getAndSetAsync"),(0,t.Uk)(" 方法大同小异，也就是异步方法通过 "),(0,t.Wm)("code",null,"commandExecutor"),(0,t.Uk)(" 执行 redis 命令或 Lua 脚本，而同步方法则阻塞获取异步方法返回的 "),(0,t.Wm)("code",null,"Future"),(0,t.Uk)(" 结果。")],-1),G=(0,t.Wm)("p",null,[(0,t.Wm)("code",null,"addListener"),(0,t.Uk)(" 方法和 "),(0,t.Wm)("code",null,"addListenerAsync"),(0,t.Uk)(" 方法的源码看起来有些奇怪：")],-1),K=(0,t.Wm)("div",{class:"language-java ext-java line-numbers-mode"},[(0,t.Wm)("pre",{class:"language-java"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token annotation punctuation"},"@Override"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"public"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"int"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"addListener"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"ObjectListener"),(0,t.Uk)(" listener"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 从这里的 if 语句可以推测父类不支持 SetObjectListener，所以才必须由子类自行实现"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("listener "),(0,t.Wm)("span",{class:"token keyword"},"instanceof"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"SetObjectListener"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"addListener"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},'"__keyevent@*:set"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"SetObjectListener"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(" listener"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"SetObjectListener"),(0,t.Wm)("span",{class:"token operator"},"::"),(0,t.Wm)("span",{class:"token function"},"onSet"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"super"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"addListener"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("listener"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n"),(0,t.Wm)("span",{class:"token annotation punctuation"},"@Override"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"public"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"RFuture"),(0,t.Wm)("span",{class:"token generics"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Wm)("span",{class:"token class-name"},"Integer"),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"addListenerAsync"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"ObjectListener"),(0,t.Uk)(" listener"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("listener "),(0,t.Wm)("span",{class:"token keyword"},"instanceof"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"SetObjectListener"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"addListenerAsync"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},'"__keyevent@*:set"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"SetObjectListener"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(" listener"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"SetObjectListener"),(0,t.Wm)("span",{class:"token operator"},"::"),(0,t.Wm)("span",{class:"token function"},"onSet"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"super"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"addListenerAsync"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("listener"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])]),(0,t.Wm)("div",{class:"line-numbers"},[(0,t.Wm)("span",{class:"line-number"},"1"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"2"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"3"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"4"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"5"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"6"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"7"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"8"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"9"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"10"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"11"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"12"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"13"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"14"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"15"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"16"),(0,t.Wm)("br")])],-1),X=(0,t.Wm)("p",null,[(0,t.Uk)("居然是除方法名和返回值以外就完全一模一样的代码，"),(0,t.Wm)("code",null,"addListener"),(0,t.Uk)(" 方法为何不像其它方法那样阻塞获取 "),(0,t.Wm)("code",null,"Future"),(0,t.Uk)(" 的结果呢？是否有什么深意？")],-1),M=(0,t.Wm)("p",null,[(0,t.Uk)("往父类追溯，可以在 "),(0,t.Wm)("code",null,"RedissonObject"),(0,t.Uk)(" 中看到这样的代码：")],-1),J=(0,t.Wm)("div",{class:"language-java ext-java line-numbers-mode"},[(0,t.Wm)("pre",{class:"language-java"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token annotation punctuation"},"@Override"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"public"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"int"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"addListener"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"ObjectListener"),(0,t.Uk)(" listener"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 这里可以看到 RedissonObject 只支持过期和删除事件的监听"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("listener "),(0,t.Wm)("span",{class:"token keyword"},"instanceof"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"ExpiredObjectListener"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"addListener"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},'"__keyevent@*:expired"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"ExpiredObjectListener"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(" listener"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"ExpiredObjectListener"),(0,t.Wm)("span",{class:"token operator"},"::"),(0,t.Wm)("span",{class:"token function"},"onExpired"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("listener "),(0,t.Wm)("span",{class:"token keyword"},"instanceof"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"DeletedObjectListener"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"addListener"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},'"__keyevent@*:del"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"DeletedObjectListener"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(" listener"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"DeletedObjectListener"),(0,t.Wm)("span",{class:"token operator"},"::"),(0,t.Wm)("span",{class:"token function"},"onDeleted"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"throw"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"new"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"IllegalArgumentException"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n"),(0,t.Wm)("span",{class:"token annotation punctuation"},"@Override"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"public"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"RFuture"),(0,t.Wm)("span",{class:"token generics"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Wm)("span",{class:"token class-name"},"Integer"),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"addListenerAsync"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"ObjectListener"),(0,t.Uk)(" listener"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("listener "),(0,t.Wm)("span",{class:"token keyword"},"instanceof"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"ExpiredObjectListener"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"addListenerAsync"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},'"__keyevent@*:expired"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"ExpiredObjectListener"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(" listener"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"ExpiredObjectListener"),(0,t.Wm)("span",{class:"token operator"},"::"),(0,t.Wm)("span",{class:"token function"},"onExpired"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("listener "),(0,t.Wm)("span",{class:"token keyword"},"instanceof"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"DeletedObjectListener"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"addListenerAsync"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},'"__keyevent@*:del"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"DeletedObjectListener"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(" listener"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"DeletedObjectListener"),(0,t.Wm)("span",{class:"token operator"},"::"),(0,t.Wm)("span",{class:"token function"},"onDeleted"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"throw"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"new"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"IllegalArgumentException"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n"),(0,t.Wm)("span",{class:"token comment"},"// 访问权限是 protected，避免外部直接调用，从而保证对可用 ObjectListener 类型的控制"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"protected"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"final"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token generics"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Wm)("span",{class:"token class-name"},"T"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"extends"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"ObjectListener"),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"int"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"addListener"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"String"),(0,t.Uk)(" name"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"T"),(0,t.Uk)(" listener"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"BiConsumer"),(0,t.Wm)("span",{class:"token generics"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Wm)("span",{class:"token class-name"},"T"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"String"),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)(" consumer"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token class-name"},"RPatternTopic"),(0,t.Uk)(" topic "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"new"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"RedissonPatternTopic"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"StringCodec"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("INSTANCE"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" commandExecutor"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" name"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(" topic"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"addListener"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"String"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token keyword"},"class"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("pattern"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" channel"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" msg"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"->"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("msg"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"equals"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token function"},"getRawName"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n            consumer"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"accept"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("listener"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" msg"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n"),(0,t.Wm)("span",{class:"token keyword"},"protected"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"final"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token generics"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Wm)("span",{class:"token class-name"},"T"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"extends"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"ObjectListener"),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"RFuture"),(0,t.Wm)("span",{class:"token generics"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Wm)("span",{class:"token class-name"},"Integer"),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"addListenerAsync"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"String"),(0,t.Uk)(" name"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"T"),(0,t.Uk)(" listener"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"BiConsumer"),(0,t.Wm)("span",{class:"token generics"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Wm)("span",{class:"token class-name"},"T"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"String"),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)(" consumer"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token class-name"},"RPatternTopic"),(0,t.Uk)(" topic "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"new"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"RedissonPatternTopic"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"StringCodec"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("INSTANCE"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" commandExecutor"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" name"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(" topic"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"addListenerAsync"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"String"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token keyword"},"class"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("pattern"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" channel"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" msg"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"->"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("msg"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"equals"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token function"},"getRawName"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n            consumer"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"accept"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("listener"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" msg"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])]),(0,t.Wm)("div",{class:"line-numbers"},[(0,t.Wm)("span",{class:"line-number"},"1"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"2"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"3"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"4"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"5"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"6"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"7"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"8"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"9"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"10"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"11"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"12"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"13"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"14"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"15"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"16"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"17"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"18"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"19"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"20"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"21"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"22"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"23"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"24"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"25"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"26"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"27"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"28"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"29"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"30"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"31"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"32"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"33"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"34"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"35"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"36"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"37"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"38"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"39"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"40"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"41"),(0,t.Wm)("br")])],-1),z=(0,t.Wm)("p",null,[(0,t.Uk)("仍然是暴力的复制粘贴。再点进 "),(0,t.Wm)("code",null,"RedissonPatternTopic"),(0,t.Uk)(" 看看：")],-1),q=(0,t.Wm)("div",{class:"language-java ext-java line-numbers-mode"},[(0,t.Wm)("pre",{class:"language-java"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token annotation punctuation"},"@Override"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"public"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token generics"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Wm)("span",{class:"token class-name"},"T"),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"int"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"addListener"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"Class"),(0,t.Wm)("span",{class:"token generics"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Wm)("span",{class:"token class-name"},"T"),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)(" type"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"PatternMessageListener"),(0,t.Wm)("span",{class:"token generics"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Wm)("span",{class:"token class-name"},"T"),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)(" listener"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token class-name"},"PubSubPatternMessageListener"),(0,t.Wm)("span",{class:"token generics"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Wm)("span",{class:"token class-name"},"T"),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)(" pubSubListener "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"new"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"PubSubPatternMessageListener"),(0,t.Wm)("span",{class:"token generics"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Wm)("span",{class:"token class-name"},"T"),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("type"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" listener"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" name"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"addListener"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("pubSubListener"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n"),(0,t.Wm)("span",{class:"token annotation punctuation"},"@Override"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"public"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token generics"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Wm)("span",{class:"token class-name"},"T"),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"RFuture"),(0,t.Wm)("span",{class:"token generics"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Wm)("span",{class:"token class-name"},"Integer"),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"addListenerAsync"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"Class"),(0,t.Wm)("span",{class:"token generics"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Wm)("span",{class:"token class-name"},"T"),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)(" type"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"PatternMessageListener"),(0,t.Wm)("span",{class:"token generics"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Wm)("span",{class:"token class-name"},"T"),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)(" listener"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token class-name"},"PubSubPatternMessageListener"),(0,t.Wm)("span",{class:"token generics"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Wm)("span",{class:"token class-name"},"T"),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)(" pubSubListener "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"new"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"PubSubPatternMessageListener"),(0,t.Wm)("span",{class:"token generics"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Wm)("span",{class:"token class-name"},"T"),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("type"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" listener"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" name"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"addListenerAsync"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("pubSubListener"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n"),(0,t.Wm)("span",{class:"token keyword"},"private"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"int"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"addListener"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"RedisPubSubListener"),(0,t.Wm)("span",{class:"token generics"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Wm)("span",{class:"token operator"},"?"),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)(" pubSubListener"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token class-name"},"RFuture"),(0,t.Wm)("span",{class:"token generics"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Wm)("span",{class:"token class-name"},"Collection"),(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Wm)("span",{class:"token class-name"},"PubSubConnectionEntry"),(0,t.Wm)("span",{class:"token punctuation"},">"),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)(" future "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" subscribeService"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"psubscribe"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("channelName"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" codec"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" pubSubListener"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    commandExecutor"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"syncSubscription"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("future"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"System"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"identityHashCode"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("pubSubListener"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n"),(0,t.Wm)("span",{class:"token keyword"},"private"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"RFuture"),(0,t.Wm)("span",{class:"token generics"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Wm)("span",{class:"token class-name"},"Integer"),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"addListenerAsync"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"RedisPubSubListener"),(0,t.Wm)("span",{class:"token generics"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Wm)("span",{class:"token operator"},"?"),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)(" pubSubListener"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token class-name"},"RFuture"),(0,t.Wm)("span",{class:"token generics"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Wm)("span",{class:"token class-name"},"Collection"),(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Wm)("span",{class:"token class-name"},"PubSubConnectionEntry"),(0,t.Wm)("span",{class:"token punctuation"},">"),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)(" future "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" subscribeService"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"psubscribe"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("channelName"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" codec"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" pubSubListener"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token class-name"},"RPromise"),(0,t.Wm)("span",{class:"token generics"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Wm)("span",{class:"token class-name"},"Integer"),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)(" result "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"new"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"RedissonPromise"),(0,t.Wm)("span",{class:"token generics"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Wm)("span",{class:"token class-name"},"Integer"),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    future"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"onComplete"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("res"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" e"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"->"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("e "),(0,t.Wm)("span",{class:"token operator"},"!="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"null"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n            result"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"tryFailure"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("e"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n            "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n        result"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"trySuccess"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"System"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"identityHashCode"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("pubSubListener"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(" result"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])]),(0,t.Wm)("div",{class:"line-numbers"},[(0,t.Wm)("span",{class:"line-number"},"1"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"2"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"3"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"4"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"5"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"6"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"7"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"8"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"9"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"10"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"11"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"12"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"13"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"14"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"15"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"16"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"17"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"18"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"19"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"20"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"21"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"22"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"23"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"24"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"25"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"26"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"27"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"28"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"29"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"30"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"31"),(0,t.Wm)("br")])],-1),Y=(0,t.Wm)("p",null,[(0,t.Uk)("到了这里就可以发现，同步、异步添加监听器的逻辑，在细节上确实是有一些差异的，所以同步方法就没有直接阻塞获取异步方法的 "),(0,t.Wm)("code",null,"Future"),(0,t.Uk)(" 结果。然而，重复出现几乎完全一样的冗余代码，如果 "),(0,t.Wm)("code",null,"RedissonObject"),(0,t.Uk)(" 的其它子类也要覆写增加监听器的方法，岂不是也要搞一遍复制粘贴？")],-1),Z=(0,t.Wm)("p",null,"有没有办法将这种重复的冗余代码抽象为统一的单个方法呢？有，但得不偿失。",-1),_=(0,t.Wm)("p",null,"首先，反射几乎是有弊无利的，且不论性能问题，单单是泛型转换、字节码类型转换、异常捕获之类乱七八糟的东西就会让代码看起来又长又臭，显然用反射无法满足重构的目的。",-1),$=(0,t.Wm)("blockquote",null,[(0,t.Wm)("p",null,"如果所有子类都通过反射来调用父类方法，父类方法本身不应该用泛型，否则根本就不会编译出子类所需类型对应的父类方法。反过来，既然父类用了泛型，子类就不能在未定义具体类型方法的情况下直接做反射调用。所以，如果用反射来重构，非但代码会变烂，甚至可能引发 BUG。")],-1),nn=(0,t.Wm)("p",null,"其次，方法句柄也并不合适，原因和反射相同。",-1),sn=(0,t.Wm)("p",null,"接着，用函数式编程可以实现共同点抽取、差异点参数化，但也会让代码变得不太好理解：",-1),an=(0,t.Wm)("div",{class:"language-java ext-java line-numbers-mode"},[(0,t.Wm)("pre",{class:"language-java"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token annotation punctuation"},"@FunctionalInterface"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"private"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"interface"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"AddSetObjectListener"),(0,t.Wm)("span",{class:"token generics"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Wm)("span",{class:"token class-name"},"R"),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token class-name"},"R"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"addListener"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"String"),(0,t.Uk)(" name"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"SetObjectListener"),(0,t.Uk)(" listener"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"BiConsumer"),(0,t.Wm)("span",{class:"token generics"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Wm)("span",{class:"token class-name"},"SetObjectListener"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"String"),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)(" consumer"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n"),(0,t.Wm)("span",{class:"token annotation punctuation"},"@FunctionalInterface"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"private"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"interface"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"AddOtherObjectListener"),(0,t.Wm)("span",{class:"token generics"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Wm)("span",{class:"token class-name"},"R"),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token class-name"},"R"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"addListener"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"ObjectListener"),(0,t.Uk)(" listener"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n"),(0,t.Wm)("span",{class:"token keyword"},"private"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token generics"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Wm)("span",{class:"token class-name"},"R"),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"R"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"addListener"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"ObjectListener"),(0,t.Uk)(" listener"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"AddSetObjectListener"),(0,t.Wm)("span",{class:"token generics"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Wm)("span",{class:"token class-name"},"R"),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)(" forSet"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"AddOtherObjectListener"),(0,t.Wm)("span",{class:"token generics"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Wm)("span",{class:"token class-name"},"R"),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)(" forOther"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("listener "),(0,t.Wm)("span",{class:"token keyword"},"instanceof"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"SetObjectListener"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(" forSet"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"addListener"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},'"__keyevent@*:set"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"SetObjectListener"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(" listener"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"SetObjectListener"),(0,t.Wm)("span",{class:"token operator"},"::"),(0,t.Wm)("span",{class:"token function"},"onSet"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(" forOther"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"addListener"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("listener"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n"),(0,t.Wm)("span",{class:"token annotation punctuation"},"@Override"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"public"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"int"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"addListener"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"ObjectListener"),(0,t.Uk)(" listener"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"addListener"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("listener"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("name"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" listenerArg"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" consumer"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"->"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"super"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"addListener"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("name"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" listenerArg"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" consumer"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"super"),(0,t.Wm)("span",{class:"token operator"},"::"),(0,t.Wm)("span",{class:"token function"},"addListener"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n"),(0,t.Wm)("span",{class:"token annotation punctuation"},"@Override"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"public"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"RFuture"),(0,t.Wm)("span",{class:"token generics"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Wm)("span",{class:"token class-name"},"Integer"),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"addListenerAsync"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"ObjectListener"),(0,t.Uk)(" listener"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"addListener"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("listener"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("name"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" listenerArg"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" consumer"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"->"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"super"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"addListenerAsync"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("name"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" listenerArg"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" consumer"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"super"),(0,t.Wm)("span",{class:"token operator"},"::"),(0,t.Wm)("span",{class:"token function"},"addListenerAsync"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])]),(0,t.Wm)("div",{class:"line-numbers"},[(0,t.Wm)("span",{class:"line-number"},"1"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"2"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"3"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"4"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"5"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"6"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"7"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"8"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"9"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"10"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"11"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"12"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"13"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"14"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"15"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"16"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"17"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"18"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"19"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"20"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"21"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"22"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"23"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"24"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"25"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"26"),(0,t.Wm)("br")])],-1),tn=(0,t.Wm)("p",null,[(0,t.Uk)("如果有很多处冗余代码，这种写法是比较好的，但 "),(0,t.Wm)("code",null,"RedissonBucket"),(0,t.Uk)(" 中只不过是两处代码冗余而已（并且还比较短），这样重构就不太值得了。")],-1),en=(0,t.Wm)("p",null,"最后，能否用某种设计模式来重构呢？说到底，设计模式也是要抽取共同点并将差异点分离到不同的类上，最终只会比函数式编程的写法更加复杂。",-1),cn=(0,t.Wm)("p",null,"在 Redisson 这种久经打磨的开源项目里，出现几乎完全一样的冗余代码，应该是妥协的产物吧。",-1),on=(0,t.Wm)("p",null,[(0,t.Uk)("接下来再看看 "),(0,t.Wm)("code",null,"RedissonBucket"),(0,t.Uk)(" 的两个父类。")],-1),ln=(0,t.Wm)("p",null,[(0,t.Wm)("img",{src:e,alt:" 的父类关系"})],-1),mn=(0,t.Wm)("h3",{id:"redissonexpirable",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#redissonexpirable","aria-hidden":"true"},"#"),(0,t.Uk)(),(0,t.Wm)("code",null,"RedissonExpirable")],-1),pn=(0,t.Wm)("p",null,[(0,t.Wm)("code",null,"RedissonExpirable"),(0,t.Uk)(" 是 "),(0,t.Wm)("code",null,"RedissonBucket"),(0,t.Uk)(" 的抽象父类，实现了 "),(0,t.Wm)("code",null,"RExpirable"),(0,t.Uk)(" 接口，提供了过期设置相关的操作。")],-1),un=(0,t.Wm)("p",null,[(0,t.Wm)("code",null,"RedissonExpirable"),(0,t.Uk)(" 的代码非常简单。和 "),(0,t.Wm)("code",null,"RedissonBucket"),(0,t.Uk)(" 一样，它也是通过 "),(0,t.Wm)("code",null,"commandExecutor"),(0,t.Uk)(" 对象执行 Lua 脚本和 redis 命令，以实现异步操作，而所有同步操作则通过阻塞获取对应异步操作的 "),(0,t.Wm)("code",null,"Future"),(0,t.Uk)(" 结果来实现。")],-1),kn=(0,t.Wm)("h3",{id:"redissonobject",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#redissonobject","aria-hidden":"true"},"#"),(0,t.Uk)(),(0,t.Wm)("code",null,"RedissonObject")],-1),Wn=(0,t.Wm)("p",null,[(0,t.Wm)("code",null,"RedissonObject"),(0,t.Uk)(" 是 "),(0,t.Wm)("code",null,"RObject"),(0,t.Uk)(" 接口的实现类，接口定义了这些同步方法（"),(0,t.Wm)("code",null,"RObjectAsync"),(0,t.Uk)(" 定义了相应的异步方法）：")],-1),rn=(0,t.Wm)("thead",null,[(0,t.Wm)("tr",null,[(0,t.Wm)("th",{style:{"text-align":"center"}},"方法"),(0,t.Wm)("th",{style:{"text-align":"center"}},"作用"),(0,t.Wm)("th",{style:{"text-align":"center"}},"入参含义")])],-1),dn=(0,t.Wm)("tr",null,[(0,t.Wm)("td",{style:{"text-align":"center"}},"Long getIdleTime()"),(0,t.Wm)("td",{style:{"text-align":"center"}},"获取上次读写该对象以来经过的秒数"),(0,t.Wm)("td",{style:{"text-align":"center"}})],-1),Un=(0,t.Wm)("tr",null,[(0,t.Wm)("td",{style:{"text-align":"center"}},"long sizeInMemory()"),(0,t.Wm)("td",{style:{"text-align":"center"}},"获取该对象占用的内存大小"),(0,t.Wm)("td",{style:{"text-align":"center"}})],-1),bn=(0,t.Wm)("tr",null,[(0,t.Wm)("td",{style:{"text-align":"center"}},"void restore(byte[] state)"),(0,t.Wm)("td",{style:{"text-align":"center"}},[(0,t.Uk)("使用 "),(0,t.Wm)("code",null,"dump"),(0,t.Uk)(" 方法返回的转储数据恢复对象")]),(0,t.Wm)("td",{style:{"text-align":"center"}})],-1),An=(0,t.Wm)("tr",null,[(0,t.Wm)("td",{style:{"text-align":"center"}},"void restore(byte[] state, long timeToLive, TimeUnit timeUnit)"),(0,t.Wm)("td",{style:{"text-align":"center"}},[(0,t.Uk)("使用 "),(0,t.Wm)("code",null,"dump"),(0,t.Uk)(" 方法返回的转储数据恢复对象，并设置过期时间")]),(0,t.Wm)("td",{style:{"text-align":"center"}},"过期时间；过期时间单位")],-1),gn=(0,t.Wm)("tr",null,[(0,t.Wm)("td",{style:{"text-align":"center"}},"void restoreAndReplace(byte[] state)"),(0,t.Wm)("td",{style:{"text-align":"center"}},[(0,t.Uk)("使用 "),(0,t.Wm)("code",null,"dump"),(0,t.Uk)(" 方法返回的转储数据恢复对象，若对象已经存在则将其替换")]),(0,t.Wm)("td",{style:{"text-align":"center"}})],-1),yn=(0,t.Wm)("tr",null,[(0,t.Wm)("td",{style:{"text-align":"center"}},"void restoreAndReplace(byte[] state, long timeToLive, TimeUnit timeUnit)"),(0,t.Wm)("td",{style:{"text-align":"center"}},[(0,t.Uk)("使用 "),(0,t.Wm)("code",null,"dump"),(0,t.Uk)(" 方法返回的转储数据恢复对象，若对象已经存在则将其替换，并设置过期时间")]),(0,t.Wm)("td",{style:{"text-align":"center"}},"过期时间；过期时间单位")],-1),En=(0,t.Wm)("tr",null,[(0,t.Wm)("td",{style:{"text-align":"center"}},"byte[] dump()"),(0,t.Wm)("td",{style:{"text-align":"center"}},"获取转储数据"),(0,t.Wm)("td",{style:{"text-align":"center"}})],-1),fn=(0,t.Wm)("tr",null,[(0,t.Wm)("td",{style:{"text-align":"center"}},"boolean touch()"),(0,t.Wm)("td",{style:{"text-align":"center"}},"更新对象的最后访问时间"),(0,t.Wm)("td",{style:{"text-align":"center"}})],-1),Rn=(0,t.Wm)("tr",null,[(0,t.Wm)("td",{style:{"text-align":"center"}},"void migrate(String host, int port, int database, long timeout)"),(0,t.Wm)("td",{style:{"text-align":"center"}},"将对象迁移到另一个 redis 实例"),(0,t.Wm)("td",{style:{"text-align":"center"}},"HOST；端口；库序号；超时时间（毫秒）")],-1),In=(0,t.Wm)("tr",null,[(0,t.Wm)("td",{style:{"text-align":"center"}},"void copy(String host, int port, int database, long timeout)"),(0,t.Wm)("td",{style:{"text-align":"center"}},"将对象拷贝到另一个 redis 实例"),(0,t.Wm)("td",{style:{"text-align":"center"}},"HOST；端口；库序号；超时时间（毫秒）")],-1),hn=(0,t.Wm)("tr",null,[(0,t.Wm)("td",{style:{"text-align":"center"}},"boolean move(int database)"),(0,t.Wm)("td",{style:{"text-align":"center"}},"将对象移动到另一个库"),(0,t.Wm)("td",{style:{"text-align":"center"}},"库序号")],-1),wn=(0,t.Wm)("tr",null,[(0,t.Wm)("td",{style:{"text-align":"center"}},"String getName()"),(0,t.Wm)("td",{style:{"text-align":"center"}},"获取对象名（对应的 redis 键名）"),(0,t.Wm)("td",{style:{"text-align":"center"}})],-1),Cn=(0,t.Wm)("tr",null,[(0,t.Wm)("td",{style:{"text-align":"center"}},"boolean delete()"),(0,t.Wm)("td",{style:{"text-align":"center"}},[(0,t.Uk)("删除对象，若存在且删除成功则返回 "),(0,t.Wm)("code",null,"true")]),(0,t.Wm)("td",{style:{"text-align":"center"}})],-1),Bn=(0,t.Wm)("td",{style:{"text-align":"center"}},"boolean unlink()",-1),xn={style:{"text-align":"center"}},Qn={href:"http://www.russellluo.com/2018/08/async-del-since-redis-4-0.html",target:"_blank",rel:"noopener noreferrer"},Ln=(0,t.Uk)("异步"),Sn=(0,t.Uk)("地在之后某个时刻删除对象，若存在且操作成功则返回 "),jn=(0,t.Wm)("code",null,"true",-1),vn=(0,t.Uk)("；需要 redis 4.0 以上版本"),Pn=(0,t.Wm)("td",{style:{"text-align":"center"}},null,-1),Dn=(0,t.Wm)("tr",null,[(0,t.Wm)("td",{style:{"text-align":"center"}},"void rename(String newName)"),(0,t.Wm)("td",{style:{"text-align":"center"}},[(0,t.Uk)("修改当前对象"),(0,t.Wm)("strong",null,"在 redis 中的"),(0,t.Uk)("键名，若新键名已存在则将其覆盖")]),(0,t.Wm)("td",{style:{"text-align":"center"}},"新的键名")],-1),Tn=(0,t.Wm)("tr",null,[(0,t.Wm)("td",{style:{"text-align":"center"}},"boolean renamenx(String newName)"),(0,t.Wm)("td",{style:{"text-align":"center"}},[(0,t.Uk)("仅当新键名未存在时，修改当前对象"),(0,t.Wm)("strong",null,"在 redis 中的"),(0,t.Uk)("键名，返回是否操作成功")]),(0,t.Wm)("td",{style:{"text-align":"center"}},"新的键名")],-1),Hn=(0,t.Wm)("tr",null,[(0,t.Wm)("td",{style:{"text-align":"center"}},"boolean isExists()"),(0,t.Wm)("td",{style:{"text-align":"center"}},"检查对象是否存在"),(0,t.Wm)("td",{style:{"text-align":"center"}})],-1),On=(0,t.Wm)("tr",null,[(0,t.Wm)("td",{style:{"text-align":"center"}},"Codec getCodec()"),(0,t.Wm)("td",{style:{"text-align":"center"}},"获取当前使用的序列化编解码"),(0,t.Wm)("td",{style:{"text-align":"center"}})],-1),Fn=(0,t.Wm)("tr",null,[(0,t.Wm)("td",{style:{"text-align":"center"}},"int addListener(ObjectListener listener)"),(0,t.Wm)("td",{style:{"text-align":"center"}},[(0,t.Uk)("增加"),(0,t.Wm)("strong",null,"过期或删除"),(0,t.Uk)("事件监听器")]),(0,t.Wm)("td",{style:{"text-align":"center"}},[(0,t.Wm)("code",null,"ExpiredObjectListener"),(0,t.Uk)(" 或 "),(0,t.Wm)("code",null,"DeletedObjectListener")])],-1),Nn=(0,t.Wm)("tr",null,[(0,t.Wm)("td",{style:{"text-align":"center"}},"void removeListener(int listenerId)"),(0,t.Wm)("td",{style:{"text-align":"center"}},"移除事件监听器"),(0,t.Wm)("td",{style:{"text-align":"center"}},"事件监听器的 ID")],-1),Vn=(0,t.Wm)("p",null,[(0,t.Uk)("显然，"),(0,t.Wm)("code",null,"RObject"),(0,t.Uk)(" 接口定义的都是与数据结构无关的通用操作。")],-1),Gn=(0,t.Wm)("p",null,[(0,t.Wm)("code",null,"RedissonObject"),(0,t.Uk)(" 中定义了三个字段：")],-1),Kn=(0,t.Wm)("div",{class:"language-java ext-java line-numbers-mode"},[(0,t.Wm)("pre",{class:"language-java"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token comment"},"// 异步命令执行器"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"protected"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"final"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"CommandAsyncExecutor"),(0,t.Uk)(" commandExecutor"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// 对象名，对应的 redis key"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"protected"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"String"),(0,t.Uk)(" name"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// 序列化、反序列化编解码"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"protected"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"final"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"Codec"),(0,t.Uk)(" codec"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n")])]),(0,t.Wm)("div",{class:"line-numbers"},[(0,t.Wm)("span",{class:"line-number"},"1"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"2"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"3"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"4"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"5"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"6"),(0,t.Wm)("br")])],-1),Xn=(0,t.Wm)("p",null,[(0,t.Uk)("在阅读 "),(0,t.Wm)("code",null,"RedissonBucket"),(0,t.Uk)(" 和 "),(0,t.Wm)("code",null,"RedissonExpirable"),(0,t.Uk)(" 的源码时，可以看到几乎每个方法都在使用这三个对象，"),(0,t.Wm)("code",null,"RedissonObject"),(0,t.Uk)(" 亦然无疑。")],-1),Mn=(0,t.Wm)("p",null,[(0,t.Wm)("code",null,"RedissonObject"),(0,t.Uk)(" 同样大量利用了 "),(0,t.Wm)("code",null,"Future"),(0,t.Uk)(" 的特性，"),(0,t.Wm)("code",null,"renamenx"),(0,t.Uk)(" 方法和 "),(0,t.Wm)("code",null,"renamenxAsync"),(0,t.Uk)(" 方法就是一个典型的例子：")],-1),Jn=(0,t.Wm)("div",{class:"language-java ext-java line-numbers-mode"},[(0,t.Wm)("pre",{class:"language-java"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token annotation punctuation"},"@Override"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"public"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"boolean"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"renamenx"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"String"),(0,t.Uk)(" newName"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 阻塞获取 Future 结果；同样的配方，熟悉的味道"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"get"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token function"},"renamenxAsync"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("newName"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n"),(0,t.Wm)("span",{class:"token annotation punctuation"},"@Override"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"public"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"RFuture"),(0,t.Wm)("span",{class:"token generics"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Wm)("span",{class:"token class-name"},"Boolean"),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"renamenxAsync"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token class-name"},"String"),(0,t.Uk)(" newName"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 依然是借助 commandExecutor 执行命令"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token class-name"},"RFuture"),(0,t.Wm)("span",{class:"token generics"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Wm)("span",{class:"token class-name"},"Boolean"),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)(" future "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" commandExecutor"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"writeAsync"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token function"},"getRawName"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"StringCodec"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("INSTANCE"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"RedisCommands"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("RENAMENX"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"getRawName"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" newName"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 很好地利用了 Future 的异步能力"),(0,t.Uk)("\n    future"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"onComplete"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("isSuccessful"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" throwable"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"->"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("throwable "),(0,t.Wm)("span",{class:"token operator"},"=="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"null"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"&&"),(0,t.Uk)(" isSuccessful"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n            "),(0,t.Wm)("span",{class:"token function"},"setName"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("newName"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(" future"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])]),(0,t.Wm)("div",{class:"line-numbers"},[(0,t.Wm)("span",{class:"line-number"},"1"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"2"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"3"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"4"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"5"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"6"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"7"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"8"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"9"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"10"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"11"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"12"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"13"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"14"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"15"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"16"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"17"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"18"),(0,t.Wm)("br")])],-1),zn=(0,t.Wm)("p",null,[(0,t.Wm)("code",null,"RedissonObject"),(0,t.Uk)(" 中存在着 "),(0,t.Wm)("code",null,"String getLockByMapKey(Object key, String suffix)"),(0,t.Uk)(" 等与 "),(0,t.Wm)("code",null,"RedissonBucket"),(0,t.Uk)(" 无关的方法，这些方法不妨留到学习其它数据结构的使用时再看。")],-1),qn=(0,t.Wm)("h2",{id:"总结",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#总结","aria-hidden":"true"},"#"),(0,t.Uk)(" 总结")],-1),Yn=(0,t.Wm)("p",null,"Redisson 利用继承很好地实现了职责的抽象和复用，堪称教科书级的继承设计。",-1),Zn=(0,t.Wm)("blockquote",null,[(0,t.Wm)("p",null,"“教科书级”有两层含义："),(0,t.Wm)("ol",null,[(0,t.Wm)("li",null,"可作典范。"),(0,t.Wm)("li",null,"大家都应该能做到。咱总不能连教科书上展示的范例都学不好吧？")])],-1),_n=(0,t.Wm)("p",null,[(0,t.Uk)("Redisson 的非响应式 API 中大量地使用了 "),(0,t.Wm)("code",null,"Future"),(0,t.Uk)("，优雅地在同步操作中复用异步操作的代码。不过，目前并没有见到 Redisson 利用 "),(0,t.Wm)("code",null,"Future"),(0,t.Uk)(" 来实现多线程协同（毕竟那才是 "),(0,t.Wm)("code",null,"Future"),(0,t.Uk)(" 的优势区间，不过 Redisson 作为一个 redis 客户端可能也确实用不上），而只是使用了 "),(0,t.Wm)("code",null,"onComplete"),(0,t.Uk)(" 等生命周期 Hook 功能来做回调。")],-1),$n=(0,t.Wm)("p",null,[(0,t.Wm)("code",null,"RBucket"),(0,t.Uk)(" 实际上是对 Value 结构的封装。与 Lettuce 的 "),(0,t.Wm)("code",null,"ValueOperations"),(0,t.Uk)(" 相比，它的关注点并非"),(0,t.Wm)("strong",null,"操作"),(0,t.Uk)("，而是"),(0,t.Wm)("strong",null,"对象的容器"),(0,t.Uk)("，与我们日常开发的面向对象思维更加匹配；此外，其提供的功能也更加丰富。")],-1),ns={render:function(n,s){const a=(0,t.up)("OutboundLink");return(0,t.wg)(),(0,t.j4)(t.HY,null,[c,o,l,m,p,u,k,W,i,r,d,U,b,A,g,y,E,f,R,I,h,w,C,B,x,Q,L,S,j,v,P,D,T,H,O,F,N,V,G,K,X,M,J,z,q,Y,Z,_,$,nn,sn,an,tn,en,cn,on,ln,mn,pn,un,kn,Wn,(0,t.Wm)("table",null,[rn,(0,t.Wm)("tbody",null,[dn,Un,bn,An,gn,yn,En,fn,Rn,In,hn,wn,Cn,(0,t.Wm)("tr",null,[Bn,(0,t.Wm)("td",xn,[(0,t.Wm)("a",Qn,[Ln,(0,t.Wm)(a)]),Sn,jn,vn]),Pn]),Dn,Tn,Hn,On,Fn,Nn])]),Vn,Gn,Kn,Xn,Mn,Jn,zn,qn,Yn,Zn,_n,$n],64)}}}}]);